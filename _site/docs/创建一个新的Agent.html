<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
    <meta charset='utf-8'>
    <title>Huginn-China | 创建一个新的 Agent</title>
    <link rel='stylesheet' href='/static/main.css' type='text/css'/>
    <link rel='stylesheet' href='/static/media.css' type='text/css'/>
    <link rel="stylesheet" href='/static/pygments.css' type='text/css'/>
    <link rel="apple-touch-icon" sizes="56x48" href="/static/images/favicon/logo56*48.png">
	<!-- <link rel="apple-touch-icon" sizes="60x60" href="/static/images/favicon/apple-icon-60x60.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/static/images/favicon/apple-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="76x76" href="/static/images/favicon/apple-icon-76x76.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/static/images/favicon/apple-icon-114x114.png">
	<link rel="apple-touch-icon" sizes="120x120" href="/static/images/favicon/apple-icon-120x120.png">
	<link rel="apple-touch-icon" sizes="144x144" href="/static/images/favicon/apple-icon-144x144.png">
	<link rel="apple-touch-icon" sizes="152x152" href="/static/images/favicon/apple-icon-152x152.png">
	<link rel="apple-touch-icon" sizes="180x180" href="/static/images/favicon/apple-icon-180x180.png"> -->
	<link rel="icon" type="image/png" sizes="56x48"  href="/static/images/favicon/logo56*48.png">
	<!-- <link rel="icon" type="image/png" sizes="32x32" href="/static/images/favicon/favicon-32x32.png">
	<link rel="icon" type="image/png" sizes="96x96" href="/static/images/favicon/favicon-96x96.png">
	<link rel="icon" type="image/png" sizes="16x16" href="/static/images/favicon/favicon-16x16.png"> -->
	<link rel="manifest" href="/static/images/favicon/manifest.json">
	<meta name="msapplication-TileColor" content="#ffffff">
	<meta name="msapplication-TileImage" content="/static/images/favicon/ms-icon-144x144.png">
	<meta name="theme-color" content="#ffffff">
    <meta name='viewport' content='width=480'>
    <meta property="og:title" content="创建一个新的 Agent" />
    <meta property="og:site_name" content="Huginn-China">
    <meta property='og:description' content='Huginn-China'>
    <!-- <meta property='og:image' content='http://asyncdisplaykit.org/static/asyncdisplaykit-og-image.png'>
    <meta property='og:url' content="http://asyncdisplaykit.org/docs/创建一个新的Agent.html"> -->
    <meta property='og:type' content='website'>
    <script type="text/javascript" src="//use.typekit.net/vqa1hcx.js"></script>
    <script type="text/javascript">{'try{Typekit.load();}catch(e){}'}</script>
    <script src="/static/toggle.js"></script>
    <link href='https://fonts.googleapis.com/css?family=Inconsolata' rel='stylesheet' type='text/css'>
    
</head>
<body>
<header>
	<div class="container">
		<h1 id="logo"><a href="/"><img src="../static/images/huginn_logo.png" alt="AsyncDisplayKit" width="90" height="39"></a></h1>
		<nav>
			<ul>
				<li><a href="/docs/Huginn简介.html"  class="active" >文档</a></li>
				<li><a href="http://bbs.huginn.cn/" >论坛</a></li>
				<li><a href="https://github.com/huginn-china">github</a></li>
	    	</ul>
		</nav>
		<div style="clear: both;"></div>
	</div>
</header>


<div class="container container-margin">
	
	<div class="sidebar">
		<nav class='toc'>
  
    <section>
      <h3>概述</h3>
      <ul>
        
          
            
            
          
            
            
            <li>
              <a href=/docs/Huginn简介.html>
                Huginn 简介
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
      </ul>
    </section>
  
    <section>
      <h3>安装教程</h3>
      <ul>
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/初学者向导.html>
                初学者向导
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/本地运行Huginn.html>
                本地运行 Huginn
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/在Ubuntu-Debian上安装Huginn.html>
                在 Ubuntu/Debian 上安装 Huginn
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
            <li>
              <a href=/docs/Huginn的Apache配置.html>
                Huginn 的 Apache 配置
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/为什么要在docker上运行Huginn.html>
                为什么要在 docker 上运行 Huginn
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/使用PostgreSQL代替Mysql.html>
                使用 PostgreSQL 代替 Mysql
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/在Vagrant和VirtualBox上面部署Huginn.html>
                在 Vagrant 和 VirtualBox 上面部署 Huginn
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/用chefsolo和vagrant在各种服务器或VirtualBox上部署Huginn.html>
                用 chef solo 和 vagrant 在各种服务器或 VirtualBox 上部署 huginn
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/部署到Heroku.html>
                部署到 Heroku
              </a>
            </li>
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/部署到Cloud9(C9).html>
                部署到 Cloud9(C9)
              </a>
            </li>
            
          
            
            
          
            
            
          
        
      </ul>
    </section>
  
    <section>
      <h3>使用教程</h3>
      <ul>
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/让所有网页变成RSS——Huginn.html>
                让所有网页变成RSS —— Huginn
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/使用ManualEventAgent.html>
                使用 ManualEventAgent
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/利用Cloudmailin服务解析邮件.html>
                利用 Cloudmailin 服务解析邮件
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/利用Liquid模板引擎格式化事件.html>
                利用 Liquid 模板引擎格式化事件
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/用Huginn来为你省钱.html>
                用 Huginn 来为你省钱
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/用Huginn，让你再也不会忘记带伞.html>
                用 Huginn，让你再也不会忘记带伞
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/第三方应用通过WebhookAgent连接Huginn.html>
                第三方应用服务使用 Webhook Agent 连接 Huginn
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/筛选RSS源，制作新的全文RSS源.html>
                筛选 RSS 源，制作新的全文 RSS 源
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/让Huginn告诉你这个世界的变化.html>
                让 Huginn 告诉你这个世界的变化
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/配置带有OAuth验证的应用.html>
                配置带有 OAuth 验证的应用
              </a>
            </li>
            
          
        
      </ul>
    </section>
  
    <section>
      <h3>扩展</h3>
      <ul>
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/创建一个新的Agent.html class="active">
                创建一个新的 Agent
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/调试Agent.html>
                调试 Agent
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
        
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
            <li>
              <a href=/docs/私人功能开发说明.html>
                私人功能开发说明
              </a>
            </li>
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
            
            
          
        
      </ul>
    </section>
  
</nav>

	</div>
	
	<div class="content">
		<h1>
	      创建一个新的 Agent
	    </h1>
	    <p></p>
	
	    <p><em>请注意：Huginn API 一直在改进，因此一些无用的 Agent 或将被放弃。我们非常希望您能将您的使用方法以及 API 应该更改什么告诉我们。查看 <a href="https://github.com/cantino/huginn/issues/60">#60</a> 和 <a href="https://github.com/cantino/huginn/issues/293">#293</a>。</em></p>

<p>Huginn Agent 能创建和接受事件，并且能按照预定的安排在特定的时间或时间间隔运行代码。创建一个 Agent 并不难，你可以很轻松的从一个已存在的 Agent 创建一个子 Agent。</p>

<p>Agent 保存在 <code class="highlighter-rouge">app/models/agents</code>，RSpec 保存在 <code class="highlighter-rouge">spec/models/agents</code>。</p>

<h1 id="section">描述</h1>

<p>使用 <code class="highlighter-rouge">description</code> 类方法描述你的 Agent。例如：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>description &lt;&lt;-MD
  The WeatherAgent creates an event for the following day's weather at `zipcode`.

  You must setup an API key for Wunderground in order to use this Agent.
MD
</code></pre>
</div>

<h1 id="section-1">选项</h1>

<p>Agent 是用户使用 JSON 结构进行配置的，<code class="highlighter-rouge">options</code>(选项)非常容易使用，同时还可以使用 <a href="https://github.com/cantino/huginn/wiki/Formatting-Events-using-Liquid">Liquid</a> 模板引擎进行更改。你应该定义一个 <code class="highlighter-rouge">default_options</code> 方法，该方法用来定义默认配置，另外，你还应该定义一个 <code class="highlighter-rouge">validate_options</code> 方法，该方法会验证 <code class="highlighter-rouge">options</code> 的内容，确保一些必填选项已经填写，通常情况下，你是不希望用户更改这些必填选项的，下面是一个具体的例子：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>def default_options
  { 'zipcode' =&gt; '94103' }
end

def validate_options
  errors.add(:base， 'zipcode is required') unless options['zipcode'].present?
end
</code></pre>
</div>

<h1 id="section-2">时间表</h1>

<p>Agent 可以被设定在特定的时间或一定的时间间隔运行，当设定的时间被触发，Agent 内的 <code class="highlighter-rouge">check</code> 方法将会被调用。如果你的 Agent 是可调度的，需要定义 <code class="highlighter-rouge">default_schedule</code> 方法定义默认值，否则会调用 <code class="highlighter-rouge">cannot_be_scheduled!</code> 方法。可用的设定时间如下：<code class="highlighter-rouge">every_1m</code>， <code class="highlighter-rouge">every_2m</code>， <code class="highlighter-rouge">every_5m</code>， <code class="highlighter-rouge">every_10m</code>， <code class="highlighter-rouge">every_30m</code>， <code class="highlighter-rouge">every_1h</code>， <code class="highlighter-rouge">every_2h</code>， <code class="highlighter-rouge">every_5h</code>， <code class="highlighter-rouge">every_12h</code>， <code class="highlighter-rouge">every_1d</code>， <code class="highlighter-rouge">every_2d</code>， <code class="highlighter-rouge">every_7d</code>， <code class="highlighter-rouge">midnight</code>， <code class="highlighter-rouge">1am</code>， <code class="highlighter-rouge">2am</code>， <code class="highlighter-rouge">3am</code>， <code class="highlighter-rouge">4am</code>， <code class="highlighter-rouge">5am</code>， <code class="highlighter-rouge">6am</code>， <code class="highlighter-rouge">7am</code>， <code class="highlighter-rouge">8am</code>， <code class="highlighter-rouge">9am</code>， <code class="highlighter-rouge">10am</code>， <code class="highlighter-rouge">11am</code>， <code class="highlighter-rouge">noon</code>， <code class="highlighter-rouge">1pm</code>， <code class="highlighter-rouge">2pm</code>， <code class="highlighter-rouge">3pm</code>， <code class="highlighter-rouge">4pm</code>， <code class="highlighter-rouge">5pm</code>， <code class="highlighter-rouge">6pm</code>， <code class="highlighter-rouge">7pm</code>， <code class="highlighter-rouge">8pm</code>， <code class="highlighter-rouge">9pm</code>， <code class="highlighter-rouge">10pm</code>， <code class="highlighter-rouge">11pm</code>。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>default_schedule "8pm"

def check
  wunderground.forecast_for(interpolated['zipcode'])['forecast']['simpleforecast']['forecastday'].each do |day|
    if is_tomorrow?(day)
      create_event :payload =&gt; day.merge('zipcode' =&gt; interpolated['zipcode'])
    end
  end
end
</code></pre>
</div>

<p>如果你的Agent创建了事件，比如像 <a href="https://github.com/cantino/huginn/blob/master/app/models/agents/weather_agent.rb">WeatherAgent</a> 这样，你应该使用 <code class="highlighter-rouge">event_description</code> 类方法描述这些事件包含哪些数据。</p>

<div class="highlighter-rouge"><pre class="highlight"><code>event_description &lt;&lt;-MD
  Events look like this:

      {
        'zipcode' =&gt; 12345，
        ...
        'maxhumidity' =&gt; 93，
        'minhumidity' =&gt; 63
      }
MD
</code></pre>
</div>

<h1 id="section-3">接受事件</h1>

<p>如果你的 Agent 能接受事件，定义 <code class="highlighter-rouge">receive</code> 方法，该方法接受事件的 array，否则调用 <code class="highlighter-rouge">cannot_receive_events!</code> 注释掉它。</p>

<h1 id="section-4">创建事件</h1>

<p>在代码中，你的 Agent 可以通过 <code class="highlighter-rouge">create_event :payload =&gt; { ... }</code> 创建事件，否则调用 <code class="highlighter-rouge">cannot_create_events!</code> 注释掉它。</p>

<h1 id="section-5">内存</h1>

<p>Agent 拥有内存池，可以用在时间间隔内或接受事件之间维持状态。它会被自动加载并保存，可通过 <code class="highlighter-rouge">memory</code> 获得。</p>

<h1 id="section-6">日志</h1>

<p>你的 Agent 应该创建日志，尤其是错误发生的时候。通过调用 <code class="highlighter-rouge">log</code> 或 <code class="highlighter-rouge">error</code> 打印日志信息，还可以使用 <code class="highlighter-rouge">:outbound_event</code> 或 <code class="highlighter-rouge">:inbound_event</code> 监测事件有关的日志信息。</p>

<h1 id="section-7">正在工作吗?</h1>

<p>最好将 Agent 实例的运行状态反馈给用户。你需要定义 <code class="highlighter-rouge">working?</code> 方法，当一切正常的时候，该方法返回 true。下面的例子中，Agent 创建事件并有一个 <code class="highlighter-rouge">expected_update_period_in_days</code> 选项：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>def working?
  event_created_within?(interpolated['expected_update_period_in_days']) &amp;&amp; !recent_error_logs?
end
</code></pre>
</div>

<p>当然，你也可以写一些特殊的代码在 <code class="highlighter-rouge">working?</code> 方法中。</p>

<h1 id="ui">UI</h1>

<p>Agent 的 UI 文件保存在 <code class="highlighter-rouge">app/views/agents/agent_views/&lt;agent name&gt;/_show.html.erb</code> 中。如果你需要一些服务器端的功能，你可以 POST 数据到 <code class="highlighter-rouge">handle_details_post_agent_path</code>，使用 <code class="highlighter-rouge">handle_details_post</code> 方法进行处理。查看示例： <a href="https://github.com/cantino/huginn/blob/master/app/models/agents/manual_event_agent.rb">ManualEventAgent</a> 和 <a href="https://github.com/cantino/huginn/blob/master/app/views/agents/agent_views/manual_event_agent/_show.html.erb">details view</a>。</p>

<h1 id="web">接收web请求</h1>

<p>通过 <code class="highlighter-rouge">receive_web_request</code>，你的 Agent 可以接收 web 请求。你的 Agent URL 像这样 <code class="highlighter-rouge">http://yourserver.com/users/:user_id/web_requests/:agent_id/:secret</code>，<code class="highlighter-rouge">:user_id</code> 是用户的 ID， <code class="highlighter-rouge">:agent_id</code> 是 Agent 的 ID，<code class="highlighter-rouge">secret</code> 是用户的特殊 token，通过 <code class="highlighter-rouge">receive_web_request</code> 验证。推荐每次调用 <code class="highlighter-rouge">receive_web_request</code> 时都要验证 token。例如，你的 Agent 有一个 <code class="highlighter-rouge">secret</code> 的选项，每次调用 <code class="highlighter-rouge">receive_web_request</code> 时，都将其与 params[:secret] 进行比较，从而过滤掉那些无效的请求，</p>

<p>你的 Agent 的 <code class="highlighter-rouge">receive_web_request</code> 方法应该返回一个数组 (status， MiME type) 作为响应，示例如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>[{ status: "success" }， 200]
</code></pre>
</div>

<p>或</p>

<div class="highlighter-rouge"><pre class="highlight"><code>["not found"， 404， 'text/plain']
</code></pre>
</div>

<p>这里有一个 <code class="highlighter-rouge">receive_web_request</code> 例子，如下所示：</p>

<div class="language-ruby highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">receive_web_request</span><span class="p">(</span><span class="n">params</span><span class="err">，</span> <span class="nb">method</span><span class="err">，</span> <span class="nb">format</span><span class="p">)</span>
  <span class="n">secret</span> <span class="o">=</span> <span class="n">params</span><span class="p">.</span><span class="nf">delete</span><span class="p">(</span><span class="s1">'secret'</span><span class="p">)</span>
  <span class="k">return</span> <span class="p">[</span><span class="s2">"Please use POST requests only"</span><span class="err">，</span> <span class="mi">401</span><span class="p">]</span> <span class="k">unless</span> <span class="nb">method</span> <span class="o">==</span> <span class="s2">"post"</span>
  <span class="k">return</span> <span class="p">[</span><span class="s2">"Not Authorized"</span><span class="err">，</span> <span class="mi">401</span><span class="p">]</span> <span class="k">unless</span> <span class="n">secret</span> <span class="o">==</span> <span class="n">interpolated</span><span class="p">[</span><span class="s1">'secret'</span><span class="p">]</span>

  <span class="c1"># do something with params here</span>

  <span class="p">[</span><span class="s1">'Done!'</span><span class="err">，</span> <span class="mi">200</span><span class="err">，</span> <span class="s1">'text/plain'</span><span class="p">]</span>
<span class="k">end</span>
</code></pre>
</div>

<p>如果你需要从请求中获得更多的参数，也可以定义 <code class="highlighter-rouge">receive_web_request</code> 方法如下：</p>

<div class="highlighter-rouge"><pre class="highlight"><code>def receive_web_request(request)
end
</code></pre>
</div>

<p>在 <a href="https://github.com/cantino/huginn/blob/master/app/controllers/web_requests_controller.rb">WebRequestsController</a> 查看更多详细信息，可参考 <a href="https://github.com/cantino/huginn/blob/master/app/models/agents/webhook_agent.rb">WebhookAgent</a> 和 <a href="https://github.com/cantino/huginn/blob/master/app/models/agents/data_output_agent.rb">DataOutputAgent</a> 中的 <code class="highlighter-rouge">receive_web_request</code>。</p>

<blockquote>
  <p>本文由 <a href="http://huginn.cn">Huginn 中文网</a> 翻译，已经获得项目作者授权，项目原文访问 <a href="https://github.com/cantino/huginn/wiki/Creating-a-new-agent">Creating a new agent</a></p>
</blockquote>


	    
	    <p><a class="edit-page-link btn" href="https://github.com/huginn-china/huginn-china.github.io/tree/master/_docs/创建一个新的Agent.md" target="_blank">在 GitHub 上修改文档</a></p>

	
	    <div class="docs-prevnext">
	      
	        <a href="/docs/network-image-node.html">&larr; Prev</a>
	      
	      
	        <a class="right" href="/docs/map-node.html">Next &rarr;</a>
	      
	    </div>
	
	    <a id="_"></a>
	</div>
	
	<div style="clear:both;"></div>
</div>

<footer class="copyright">
	<div class='container'>
		<p>a Facebook &amp; Pinterest</a> collaboration &#x2665;</p>
	</div>
</footer>

<script src="/static/linkify.js"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
   (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-44373548-4', 'auto');
  ga('send', 'pageview');

  !function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");
</script>
</body>
</html>

